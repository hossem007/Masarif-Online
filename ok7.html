<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>حاسبة تقسيم المصاريف الجماعية</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
    overflow-y: auto;
    scroll-behavior: smooth;
}
body::-webkit-scrollbar { width: 0; background: transparent; }

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    direction: rtl;
    color: #eee;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    text-align: center;
    padding: 15px;
    position: relative;
    background: linear-gradient(135deg, #000000 0%, #7a0000 100%);
}

h2 { color: #ff4d4d; cursor: default; text-align: center; }
h3 { color: #aad8ff; cursor: default; }

table {
    border-collapse: collapse;
    margin: 20px auto 0 auto;
    width: 100%;
    max-width: 100%;
    table-layout: fixed;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
    background: #1e1e1e;
}

th, td {
    padding: 12px;
    text-align: center;
    word-break: break-word;
    border-bottom: 1px solid #444;
    font-size: 18px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

th {
    background: linear-gradient(to right, #7a0000, #ff1a1a);
    color: #fff;
}

tr:nth-child(even) { background-color: #2a2a2a; }
tr:hover { background-color: #3a4f72; transition: 0.3s; }

input.amountInput, input.nameInput {
    width: 100%;
    box-sizing: border-box;
    padding: 10px;
    border-radius: 6px;
    border: 1px solid #555;
    background: #1e1e1e;
    color: #fff;
    font-size: 18px;
    transition: font-size 0.3s ease; /* تأثير سلس لتغير حجم الخط */
}

input.amountInput:focus, input.nameInput:focus {
    border-color: #ff4d4d;
    outline: none;
    box-shadow: 0 0 5px rgba(255,77,77,0.5);
}

.icon-btn {
    font-size: 24px;
    margin: 5px 5px 15px 5px;
    padding: 10px;
    border: none;
    border-radius: 50%;
    background: linear-gradient(to right, #7a0000, #ff1a1a);
    color: #fff;
    cursor: pointer;
    transition: 0.3s;
}
.icon-btn:hover { background: linear-gradient(to right, #ff1a1a, #7a0000); }
.icon-btn:active { transform: scale(0.95); }

table td button.icon-btn {
    font-size: 18px;
    padding: 5px;
    width: 36px;
    height: 36px;
    line-height: 36px;
    border-radius: 50%;
}

table td:nth-child(3) {
    display: flex;
    justify-content: center;
    align-items: center;
}

table th:nth-child(1), table td:nth-child(1) { width: 25%; }
table th:nth-child(2), table td:nth-child(2) { width: 65%; }
table th:nth-child(3), table td:nth-child(3) { width: 10%; }

#totalAmount, #perPerson, #resultText {
    font-weight: bold;
    font-size: 18px;
    margin: 5px auto;
}

#totalAmount { color: #00FF7F; }
#perPerson { color: #00BFFF; }
.amount { color: #ff4d4d; font-weight: bold; }

.reset-btn {
    font-size: 22px;
    margin-top: 15px;
    background: linear-gradient(to right, #7a0000, #ff1a1a);
    color: white;
    border: none;
    border-radius: 50%;
    padding: 12px;
    cursor: pointer;
    transition: 0.3s;
}
.reset-btn:hover { background: linear-gradient(to right, #ff1a1a, #7a0000); }

@media (max-width: 600px) {
    th, td { font-size: 16px; padding: 8px; }
    .icon-btn { font-size: 20px; padding: 8px; }
    table td button.icon-btn { font-size: 16px; width: 30px; height: 30px; line-height: 30px; }
    #resultText, #perPerson, #totalAmount { font-size: 16px; }
    input.amountInput, input.nameInput { font-size: 16px; }
}
</style>
</head>
<body>

<h2>حاسبة تقسيم المصاريف الجماعية</h2>

<table id="inputTable">
  <tr>
    <th>الاسم</th>
    <th>المبلغ المدفوع</th>
    <th>X</th>
  </tr>
</table>

<button class="icon-btn" onclick="addPerson()" title="إضافة شخص"><i class="fas fa-plus"></i></button>
<button class="icon-btn" onclick="clearAll()" title="مسح الكل"><i class="fas fa-trash-alt"></i></button>

<div id="totalAmount">المبلغ الكلي: 0</div>
<div id="perPerson">نصيب كل شخص: 0</div>

<h3>النتيجة:</h3>
<div id="resultText"></div>

<button class="reset-btn" onclick="resetToDefault()" title="إرجاع للوضع الأصلي"><i class="fas fa-rotate-left"></i></button>

<script>
const STORAGE_KEY = "expense_data";
const DEFAULT_NAMES = ["حسام", "داود", "محمد"];

// تعديل حجم الخط تدرجي مع تأثير سلس
function adjustFontSize(input) {
    let val = input.value.replace(/[^0-9]/g, '');
    let defaultSize = 18;
    let steps = Math.floor(val.length / 5); // كل 5 أرقام = خطوة
    let newSize = defaultSize - (steps * 2);
    if(newSize < 10) newSize = 10; // الحد الأدنى
    input.style.fontSize = newSize + "px";
}


function saveData() {
    const rows = document.querySelectorAll("#inputTable tr:not(:first-child)");
    const data = [];
    rows.forEach(row => {
        const name = row.querySelector(".nameInput").value.trim();
        const amount = row.querySelector(".amountInput").value.trim();
        if (name !== "" || amount !== "") {
            data.push({ name, amount });
        }
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function loadData() {
    const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    const table = document.getElementById("inputTable");

    if (data.length === 0) {
        DEFAULT_NAMES.forEach(name => {
            const row = table.insertRow();
            const c1 = row.insertCell(0);
            const c2 = row.insertCell(1);
            const c3 = row.insertCell(2);
            c1.innerHTML = `<input type="text" class="nameInput" value="${name}">`;
            c2.innerHTML = `<input type="tel" class="amountInput" placeholder="0">`;
            c3.innerHTML = `<button class="icon-btn" onclick="deletePerson(this)" title="حذف"><i class="fas fa-trash"></i></button>`;
        });
    } else {
        data.forEach(item => {
            const row = table.insertRow();
            const c1 = row.insertCell(0);
            const c2 = row.insertCell(1);
            const c3 = row.insertCell(2);
            c1.innerHTML = `<input type="text" class="nameInput" value="${item.name}">`;
            c2.innerHTML = `<input type="tel" class="amountInput" value="${item.amount}" placeholder="0">`;
            c3.innerHTML = `<button class="icon-btn" onclick="deletePerson(this)" title="حذف"><i class="fas fa-trash"></i></button>`;
        });
    }
    addListeners();
    document.querySelectorAll(".amountInput").forEach(input => adjustFontSize(input));
}

function addPerson() {
    const table = document.getElementById("inputTable");
    const row = table.insertRow();
    const c1 = row.insertCell(0);
    const c2 = row.insertCell(1);
    const c3 = row.insertCell(2);
    c1.innerHTML = `<input type="text" class="nameInput" placeholder="الاسم">`;
    c2.innerHTML = `<input type="tel" class="amountInput" placeholder="0">`;
    c3.innerHTML = `<button class="icon-btn" onclick="deletePerson(this)" title="حذف"><i class="fas fa-trash"></i></button>`;
    addListeners();
    saveData();
}

function deletePerson(btn) {
    btn.closest("tr").remove();
    saveData();
    calculate();
}

function clearAll() {
    localStorage.removeItem(STORAGE_KEY);
    document.querySelectorAll("#inputTable tr:not(:first-child)").forEach(tr => tr.remove());
    DEFAULT_NAMES.forEach(name => {
        const table = document.getElementById("inputTable");
        const row = table.insertRow();
        const c1 = row.insertCell(0);
        const c2 = row.insertCell(1);
        const c3 = row.insertCell(2);
        c1.innerHTML = `<input type="text" class="nameInput" value="${name}">`;
        c2.innerHTML = `<input type="tel" class="amountInput" placeholder="0">`;
        c3.innerHTML = `<button class="icon-btn" onclick="deletePerson(this)" title="حذف"><i class="fas fa-trash"></i></button>`;
    });
    addListeners();
    document.querySelectorAll(".amountInput").forEach(input => adjustFontSize(input));
    saveData();
    document.getElementById("resultText").innerHTML = "";
    document.getElementById("totalAmount").innerText = "المبلغ الكلي: 0";
    document.getElementById("perPerson").innerText = "نصيب كل شخص: 0";
}

function resetToDefault() {
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
}

function addListeners() {
    const inputs = document.querySelectorAll(".nameInput, .amountInput");
    inputs.forEach((input) => {
        input.removeEventListener("input", saveData);
        input.addEventListener("input", () => {
            saveData();
            calculate();
            if(input.classList.contains("amountInput")) adjustFontSize(input);
        });
        if(input.classList.contains("amountInput")) {
            input.addEventListener("keydown", (e) => {
                if(e.key === "Enter") {
                    e.preventDefault();
                    const rows = Array.from(document.querySelectorAll("#inputTable tr:not(:first-child)"));
                    const currentRow = input.closest("tr");
                    const currentIndex = rows.indexOf(currentRow);
                    if(currentIndex < rows.length - 1){
                        rows[currentIndex + 1].querySelector(".amountInput").focus();
                    } else {
                        addPerson();
                        rows[rows.length].querySelector(".amountInput").focus();
                    }
                }
            });
        }
    });
}

function calculate() {
    const rows = document.querySelectorAll("#inputTable tr:not(:first-child)");
    const resultDiv = document.getElementById("resultText");
    const totalDiv = document.getElementById("totalAmount");
    const perDiv = document.getElementById("perPerson");

    let names = [], amounts = [];
    resultDiv.innerHTML = "";

    rows.forEach(row => {
        const name = row.querySelector(".nameInput").value.trim();
        let val = row.querySelector(".amountInput").value.trim();
        if (name !== "" && val !== "") {
            let amt = 0;
            try { amt = eval(val.replace(/[^0-9+\-*/().]/g, '')) || 0; } catch(e){ amt=0; }
            names.push(name);
            amounts.push(amt);
        }
    });

    const n = names.length;
    if (n === 0) {
        totalDiv.innerText = "المبلغ الكلي: 0";
        perDiv.innerText = "نصيب كل شخص: 0";
        return;
    }

    const total = amounts.reduce((a,b)=>a+b,0);
    const share = total / n;
    totalDiv.innerText = "المبلغ الكلي: " + Math.round(total);
    perDiv.innerText = "نصيب كل شخص: " + Math.round(share);

    const diffs = amounts.map(a=>a-share);
    const positives = diffs.map((d,i)=>d>0?{index:i,value:d}:null).filter(x=>x);
    const negatives = diffs.map((d,i)=>d<0?{index:i,value:-d}:null).filter(x=>x);
    const sumPos = positives.reduce((a,b)=>a+b.value,0);

    negatives.forEach(neg=>{
        positives.forEach(pos=>{
            const pay = sumPos===0?0:neg.value*(pos.value/sumPos);
            if(pay>0){
                resultDiv.innerHTML += `${names[neg.index]} يعطي ${names[pos.index]} <span class="amount">${Math.round(pay)}</span><br>`;
            }
        });
    });
}

loadData();
calculate();
</script>

</body>
</html>
